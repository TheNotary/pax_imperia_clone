import { Galaxy } from './galaxy';
import { GameSettings } from '../gameSettings';

const systemsJson = `{"gameClock":{},"timeOrigin":1698619317388.194,"nextShipId":6,"nextColonyId":5,"systems":[{"id":0,"name":"Pictor","position":{"x":242,"y":202,"z":6.83},"radius":5,"wormholes":[{"id":"0_1","name":"???","systemId":0,"toId":1,"srcSystemPosition":{"x":242,"y":202,"z":6.83},"dstSystemPosition":{"x":91,"y":244,"z":1.91}}],"stars":[{"index":0,"atmosphere":"sun","size":1.77,"distance_from_star":0,"spin_speed":1.4,"starting_angle":0}],"planets":[{"id":0,"number":0,"atmosphere":"earthlike0009","cloud_type":"clouds0007","size":1.13,"distance_from_star":4.1,"spin_speed":1.3,"starting_angle":1.63},{"id":1,"number":1,"atmosphere":"earthlike0007","cloud_type":"clouds0003","size":1.17,"distance_from_star":7.04,"spin_speed":0.8,"starting_angle":2.68}],"colonies":[{"id":0,"playerId":1,"planetId":0,"startTime":0,"lastUpdated":0,"resources":{"food":1000,"wood":1000,"metal":0},"population":1000,"buildings":{"housing":2,"farm":1,"foodStorage":2,"woodStorage":1},"buildingQueue":[],"workAllocation":{"farm":500,"gather":500}},{"id":1,"playerId":2,"planetId":1,"startTime":0,"lastUpdated":0,"resources":{"food":1000,"wood":1000,"metal":0},"population":1000,"buildings":{"housing":2,"farm":1,"foodStorage":2,"woodStorage":1},"buildingQueue":[],"workAllocation":{"farm":500,"gather":500}}],"ships":[{"name":"Galactic Potato 0","id":0,"systemId":0,"playerId":1,"position":{"x":11.95,"y":6.18,"z":10.91},"shipSpec":{"make":"GalacticLeopard","model":6,"size":0.00015}}]},{"id":1,"name":"Mirzam","position":{"x":91,"y":244,"z":1.91},"radius":5,"wormholes":[{"id":"1_0","name":"???","systemId":1,"toId":0,"srcSystemPosition":{"x":91,"y":244,"z":1.91},"dstSystemPosition":{"x":242,"y":202,"z":6.83}},{"id":"1_2","name":"???","systemId":1,"toId":2,"srcSystemPosition":{"x":91,"y":244,"z":1.91},"dstSystemPosition":{"x":73,"y":48,"z":-7.95}}],"stars":[{"index":0,"atmosphere":"sun","size":2.36,"distance_from_star":0,"spin_speed":1,"starting_angle":0}],"planets":[{"id":2,"number":0,"atmosphere":"earthlike0008","cloud_type":"clouds0007","size":0.94,"distance_from_star":4.49,"spin_speed":0.6,"starting_angle":0.52},{"id":3,"number":1,"atmosphere":"earthlike0005","cloud_type":"clouds0008","size":0.76,"distance_from_star":7.6,"spin_speed":1.1,"starting_angle":0.19},{"id":4,"number":2,"atmosphere":"earthlike0004","cloud_type":"clouds0004","size":0.61,"distance_from_star":9.85,"spin_speed":0.9,"starting_angle":2.03},{"id":5,"number":3,"atmosphere":"earthlike0002","cloud_type":"clouds0002","size":0.54,"distance_from_star":11.71,"spin_speed":0.7,"starting_angle":0.49}],"colonies":[{"id":2,"playerId":1,"planetId":2,"startTime":0,"lastUpdated":0,"resources":{"food":1000,"wood":1000,"metal":0},"population":1000,"buildings":{"housing":2,"farm":1,"foodStorage":2,"woodStorage":1},"buildingQueue":[],"workAllocation":{"farm":500,"gather":500}},{"id":3,"playerId":2,"planetId":3,"startTime":0,"lastUpdated":0,"resources":{"food":1000,"wood":1000,"metal":0},"population":1000,"buildings":{"housing":2,"farm":1,"foodStorage":2,"woodStorage":1},"buildingQueue":[],"workAllocation":{"farm":500,"gather":500}}],"ships":[{"name":"Galactic Potato 1","id":1,"systemId":1,"playerId":1,"position":{"x":-11.71,"y":-3.81,"z":9.43},"shipSpec":{"make":"GalacticLeopard","model":6,"size":0.00015}},{"name":"Galactic Potato 2","id":2,"systemId":1,"playerId":2,"position":{"x":10.87,"y":-7.76,"z":10.45},"shipSpec":{"make":"GalacticLeopard","model":6,"size":0.00015}}]},{"id":2,"name":"Pyxis","position":{"x":73,"y":48,"z":-7.95},"radius":5,"wormholes":[{"id":"2_1","name":"???","systemId":2,"toId":1,"srcSystemPosition":{"x":73,"y":48,"z":-7.95},"dstSystemPosition":{"x":91,"y":244,"z":1.91}}],"stars":[{"index":0,"atmosphere":"sun","size":2.27,"distance_from_star":0,"spin_speed":1.4,"starting_angle":0}],"planets":[{"id":6,"number":0,"atmosphere":"earthlike0004","cloud_type":"clouds0005","size":0.59,"distance_from_star":3.98,"spin_speed":0.9,"starting_angle":0.25}],"colonies":[{"id":4,"playerId":1,"planetId":6,"startTime":0,"lastUpdated":0,"resources":{"food":1000,"wood":1000,"metal":0},"population":1000,"buildings":{"housing":2,"farm":1,"foodStorage":2,"woodStorage":1},"buildingQueue":[],"workAllocation":{"farm":500,"gather":500}}],"ships":[{"name":"Galactic Potato 3","id":3,"systemId":2,"playerId":1,"position":{"x":8.15,"y":1.85,"z":5.89},"shipSpec":{"make":"GalacticLeopard","model":6,"size":0.00015}},{"name":"Galactic Potato 4","id":4,"systemId":2,"playerId":2,"position":{"x":-7.24,"y":-1.34,"z":11.1},"shipSpec":{"make":"GalacticLeopard","model":6,"size":0.00015}},{"name":"Galactic Potato 5","id":5,"systemId":2,"playerId":1,"position":{"x":-13.32,"y":0.61,"z":11.27},"shipSpec":{"make":"GalacticLeopard","model":6,"size":0.00015}}]}]}`

test('it can generate a system from config', () => {
    // We need to copy the config object to modify it in our tests
    const c = Object.assign({}, GameSettings.galaxyWidget);
    c.systemCount = 3;
    const galaxy = Galaxy.generateFromConfig(c);

    // console.log(galaxy.toJSON());

    expect(galaxy.systems.length).toBe(3);
});

test("Brittle Test: use Galaxy's createFromJson method to load systemsJson", () => {
    // NOTE: When this test breaks, it's probably because the json format has changed
    // update systemsJson by running the above test and outputting the json
    // so you can copy it into the systemsJson variable

    const galaxy = new Galaxy().initializeFromJson(JSON.parse(systemsJson));

    expect(galaxy.systems.length).toBe(3);
});
